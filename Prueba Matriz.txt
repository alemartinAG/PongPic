#include "p16F887.inc"
RADIX HEX

CBLOCK	0x30
	NCOL
	NFIL
	AUX
ENDC

ORG 0x00
GOTO INICIO
	
ORG 0x04
GOTO ISR

ORG 0x05
INICIO		
		BSF	STATUS, RP0
		BSF	STATUS, RP1
		CLRF	ANSELH
		CLRF	ANSEL
		BCF	STATUS, RP1
		CLRF	TRISB
		CLRF	TRISD
		MOVLW	b'10000011'
		MOVWF	OPTION_REG
		BSF	INTCON, T0IE
		BSF	INTCON, GIE
		BCF	STATUS, RP0
		CALL	INIT_TIMER
		MOVLW	0x00
		MOVWF	PORTD
MAIN_LOOP	NOP 
		GOTO	MAIN_LOOP

INIT_TIMER  
		MOVLW	0x03
		MOVWF	TMR0
		RETURN
		
ISR
		BTFSC	INTCON, T0IF
		CALL	INTER_TMR
		
		RETFIE

INTER_TMR	
		BCF	INTCON, T0IF
		INCF	AUX, F
		BTFSS	AUX, 2
		GOTO	TERMINA
		MOVF	NCOL, W
		CALL	TABLA_COL
		MOVWF	PORTB
		MOVF	NFIL, W
		CALL	TABLA_FIL
		MOVWF	PORTD
		INCF	NCOL, F
		BTFSC	NCOL, 6
		CLRF	NCOL
		INCF	NFIL, F
		BTFSC	NFIL, 6
		CLRF	NFIL
TERMINA		CALL	INIT_TIMER
		RETURN


TABLA_COL
		ADDWF	PCL, F
		RETLW	b'11111110'
		RETLW	b'11111101'
		RETLW	b'11111011'
		RETLW	b'11110111'
		RETLW	b'11101111'
		RETLW	b'11011111'
		RETLW	b'10111111'
		RETLW	b'01111111'
		
TABLA_FIL
		ADDWF	PCL, F
		RETLW	0x01
		RETLW	0x02
		RETLW	0x04
		RETLW	0x08
		RETLW	0x10
		RETLW	0x20
		RETLW	0x40
		RETLW	0x80
		

		
		NOP
		END